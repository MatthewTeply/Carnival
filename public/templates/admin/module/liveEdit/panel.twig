<link rel="stylesheet" href="{{ __css__ }}admin/module/liveEdit/panel.css">
<link rel="stylesheet" href="{{ __css__ }}admin/notifications.css">

<div class="card le-panel" id="le-panel">
    <div class="card-header" v-on:click="visible = !visible">
        <b>LivEdit control panel</b>
    </div>
    <div class="card-body" v-show="visible">
        <form id="le-set-form" action="" method="POST">
            <input type="hidden" name="route" value="{{ route }}">
            <input type="hidden" name="url" value="{{ path('le/set') }}">
            <input type="hidden" name="template" value="{{ template }}">

            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Content</th>
                        <th>User</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="le-set-tr">
                        <td>
                            <input name="name" id="le-set-name" type="text" class="form-control" placeholder="Name">
                        </td>
                        <td>
                            <textarea name="content" id="le-set-content" class="form-control" placeholder="Content (TODO: WYSIWYG)"></textarea>
                            <input type="hidden" name="contentOriginalOuter" id="le-set-content-original-outer">
                            <input type="hidden" name="contentOriginalInner" id="le-set-content-original-inner">
                        </td>
                        <td>
                            <input type="text" class="form-control" disabled="disabled" value="{{ user.username }}">
                        </td>
                        <td>
                            <button type="submit" class="btn btn-primary">Confirm</button>
                        </td>
                    </tr>
                    <tr v-for="node in nodes">
                        <td>
                            ${ node.name }
                        </td>
                        <td>
                            ${ node.content }
                        </td>
                        <td>
                            ${ node.user }
                        </td>
                        <td>
                            <button type="button" class="btn btn-light le-edit" v-bind:data-edit-le-name="node.name">Edit</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>

<script src="{{ __scripts__ }}vue.js"></script>
<script src="{{ __scripts__ }}jquery.min.js"></script>
<script src="{{ __scripts__ }}admin/notifications.js"></script>
<script>

    window.leNodesList = new Vue({
        el: '#le-panel',
        delimiters: ['${', '}'],
        data: {
            visible: true,
            nodes: JSON.parse(`{{ nodes|toArray|json_encode|raw }}`.replace(/(\r\n|\n|\r)/gm, ""))
        },
        methods: {
            togglePanel: () => {
                this.visible = !this.visible;

                console.log(this.visible);
            }
        }
    });

</script>
<script src="{{ __scripts__ }}admin/module/liveEdit/select.js"></script>
<script src="{{ __scripts__ }}admin/module/liveEdit/set.js"></script>